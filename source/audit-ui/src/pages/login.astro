---
import Layout from '../layouts/Layout.astro';
---

<Layout title="Login - Bitsmedia Audit" showNav={false}>
	<div class="login-container">
		<div class="login-card">
			<h1>ðŸ”’ Bitsmedia Audit</h1>
			<h2>Sign In</h2>
			
			<form id="login-form">
				<div class="form-group">
					<label for="username">Username</label>
					<input type="text" id="username" name="username" required autocomplete="username" />
				</div>
				
				<div class="form-group">
					<label for="password">Password</label>
					<input type="password" id="password" name="password" required autocomplete="current-password" />
				</div>
				
				<div id="error-message" class="error"></div>
				
				<button type="submit" id="submit-btn">Sign In</button>
			</form>
			
			<div class="demo-users">
				<p><strong>Demo Users:</strong></p>
				<ul>
					<li><strong>viewer</strong> / 123 (Read-only)</li>
					<li><strong>analyst</strong> / 123 (Can draft rules)</li>
					<li><strong>admin</strong> / 123 (Full access)</li>
				</ul>
			</div>
		</div>
	</div>
</Layout>

<style>
	.login-container {
		display: flex;
		justify-content: center;
		align-items: center;
		min-height: 100vh;
		background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
	}
	.login-card {
		background: white;
		padding: 3rem;
		border-radius: 12px;
		box-shadow: 0 10px 40px rgba(0,0,0,0.2);
		width: 100%;
		max-width: 420px;
	}
	.login-card h1 {
		color: #1a1a2e;
		margin-bottom: 0.5rem;
		font-size: 2rem;
	}
	.login-card h2 {
		color: #666;
		margin-bottom: 2rem;
		font-size: 1.25rem;
		font-weight: 400;
	}
	.form-group {
		margin-bottom: 1.5rem;
	}
	.form-group label {
		display: block;
		margin-bottom: 0.5rem;
		color: #333;
		font-weight: 500;
	}
	.form-group input {
		width: 100%;
		padding: 0.75rem;
		border: 2px solid #e0e0e0;
		border-radius: 6px;
		font-size: 1rem;
		transition: border-color 0.2s;
	}
	.form-group input:focus {
		outline: none;
		border-color: #4ecca3;
	}
	.error {
		color: #e74c3c;
		margin-bottom: 1rem;
		font-size: 0.9rem;
		min-height: 20px;
	}
	button[type="submit"] {
		width: 100%;
		background: #4ecca3;
		color: #1a1a2e;
		border: none;
		padding: 1rem;
		border-radius: 6px;
		font-size: 1rem;
		font-weight: 600;
		cursor: pointer;
		transition: background 0.2s;
	}
	button[type="submit"]:hover {
		background: #45b393;
	}
	button[type="submit"]:disabled {
		background: #ccc;
		cursor: not-allowed;
	}
	.demo-users {
		margin-top: 2rem;
		padding-top: 2rem;
		border-top: 1px solid #e0e0e0;
	}
	.demo-users p {
		color: #666;
		margin-bottom: 0.5rem;
		font-size: 0.9rem;
	}
	.demo-users ul {
		list-style: none;
	}
	.demo-users li {
		color: #888;
		font-size: 0.85rem;
		margin-bottom: 0.25rem;
	}
</style>

<script>
	import { api } from '../utils/api';
	import { setAuth } from '../utils/auth';

	const form = document.getElementById('login-form') as HTMLFormElement;
	const submitBtn = document.getElementById('submit-btn') as HTMLButtonElement;
	const errorEl = document.getElementById('error-message');

	form?.addEventListener('submit', async (e) => {
		e.preventDefault();
		
		const formData = new FormData(form);
		const username = formData.get('username') as string;
		const password = formData.get('password') as string;
		
		if (errorEl) errorEl.textContent = '';
		submitBtn.disabled = true;
		submitBtn.textContent = 'Signing in...';
		
		try {
			const response = await api.post('/auth/login', { username, password });
			const { token, user } = response.data;
			
			setAuth(token, user);
			window.location.href = '/';
		} catch (error: any) {
			if (errorEl) {
				errorEl.textContent = error.response?.data?.error || 'Login failed. Please try again.';
			}
			submitBtn.disabled = false;
			submitBtn.textContent = 'Sign In';
		}
	});
</script>

